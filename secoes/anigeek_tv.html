<div class="hero-container">
  <div class="hero-background"></div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <div class="hero-logo-text">ANIME I GEEK TV</div>
    <div class="hero-subtext">streaming de animes filmes e series</div>
    <div class="meta-tags">
      <span class="rating-badge">A14</span>
      <span>LEGENDADO</span>
      <span>•</span>
      <span>DUBLADO</span>
    </div>
    <button class="btn-primary">ASSISTIR AGORA</button>
  </div>
</div>

<div id="dynamic-sections"></div>

<footer class="gemini-footer">
  <div class="gemini-mark">
    <i class="fas fa-circle"></i> AniGeek Tv Global Network <i class="fas fa-circle"></i>
  </div>
</footer>

<script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs, limit, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBC_ad4X9OwCHKvcG_pNQkKEl76Zw2tu6o",
    authDomain: "anigeeknews.firebaseapp.com",
    projectId: "anigeeknews",
    storageBucket: "anigeeknews.firebasestorage.app",
    messagingSenderId: "769322939926",
    appId: "1:769322939926:web:6eb91a96a3f74670882737"
  };

  const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
  const db = getFirestore(app);

  const configSessoes = [
    { titulo: "Recomendações AnigeekTv", sub: "recomendacoes", qtd: 24 },
    { titulo: "Lançamentos", sub: "lancamentos", qtd: 24 },
    { titulo: "Novos Episódios", sub: "novos_episodios", qtd: 24 },
    { titulo: "Clássicos AnigeekTv", sub: "classicos_anigeektv", qtd: 24 },
    { titulo: "Melhores da Temporada", sub: "melhores_da_temporada", qtd: 24 }
  ];

  async function carregarConteudo() {
    const mainContainer = document.getElementById("dynamic-sections");

    if (!mainContainer || mainContainer.dataset.loaded === "true") return;
    mainContainer.dataset.loaded = "true";

    mainContainer.innerHTML = "";

    for (const conf of configSessoes) {
      try {
        const colRef = collection(
          db,
          "anigeeknews.web.app/animes_filmes_series_games_noticias/" + conf.sub
        );

        const q = query(colRef, limit(conf.qtd));
        const snap = await getDocs(q);

        if (snap.empty) continue;

        const section = document.createElement("section");
        section.className = "content-section";
        section.innerHTML = `
          <h2 class="section-title">${conf.titulo}</h2>
          <div class="cards-row"></div>
        `;
        mainContainer.appendChild(section);

        const row = section.querySelector(".cards-row");

        snap.forEach(doc => {
          const data = doc.data();
          const cardTitulo = data.titulo || doc.id.replace(/_/g, " ");
          const cardCat = data.categoria || "Série";
          const cardImg = (data.fichaCategoria && data.fichaCategoria.perfilImg) || data.perfilImg || data.capaNoticia || data.capaUrl || "https://via.placeholder.com/640x360?text=AniGeek+TV";

          // --- LÓGICA DE REDIRECIONAMENTO INTELIGENTE ---
          const linkArtigo = data.linkArtigo || "";
          let acaoClique = "";

          if (linkArtigo.includes("secao=")) {
            // Extrai o ID após "secao=" (ex: Jujutsu_kaisen_shimetsu_kaiyu)
            const idExtraido = linkArtigo.split("secao=")[1].split("&")[0];
            acaoClique = `window.abrirAbaPorId('${idExtraido}')`;
          } else {
            // Se não tiver o parâmetro secao, abre o link normalmente ou usa o index.html?id
            const linkDestino = linkArtigo || `index.html?id=${doc.id}`;
            acaoClique = `location.href='${linkDestino}'`;
          }

          row.innerHTML += `
            <div class="anime-card" onclick="${acaoClique}">
              <div class="poster-wrapper">
                <img
                  src="${cardImg.trim()}"
                  class="poster-img"
                  loading="lazy"
                  alt="${cardTitulo}"
                >
              </div>
              <div class="anime-title">${cardTitulo}</div>
              <div class="anime-meta">${cardCat} • ${doc.id.substring(0, 5)}</div>
            </div>
          `;
        });

      } catch (e) {
        console.error("Erro ao carregar sessão:", conf.sub, e);
      }
    }
  }

  carregarConteudo();
</script>

<div class="hero-container">
    <div class="hero-background"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <div class="hero-logo-text">FRIEREN</div>
        <div class="hero-subtext">Beyond Journey's End</div>
        <div class="meta-tags">
            <span class="rating-badge">A14</span>
            <span>LEGENDADO</span>
            <span>•</span>
            <span>DUBLADO</span>
        </div>
        <button class="btn-primary">ASSISTIR AGORA</button>
    </div>
</div>

<div id="dynamic-sections"></div>

<footer class="gemini-footer">
    <div class="gemini-mark">
        <i class="fas fa-circle"></i> AniGeek Global Network <i class="fas fa-circle"></i>
    </div>
</footer>

<script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, limit, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC_ad4X9OwCHKvcG_pNQkKEl76Zw2tu6o",
        authDomain: "anigeeknews.firebaseapp.com",
        projectId: "anigeeknews",
        storageBucket: "anigeeknews.firebasestorage.app",
        messagingSenderId: "769322939926",
        appId: "1:769322939926:web:6eb91a96a3f74670882737"
    };

    // Ajuste para não travar quando injetado via navegação modular
    const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
    const db = getFirestore(app);

    const configSessoes = [
        { titulo: "Recomendados", sub: "chainsaw_man", qtd: 10 },
        { titulo: "Em Alta Agora", sub: "fire_force", qtd: 6 },
        { titulo: "Novos Episódios", sub: "Jujutsu_kaisen_shimetsu_kaiyu", qtd: 6 },
        { titulo: "Clássicos AniGeek", sub: "naruto", qtd: 8 },
        { titulo: "Melhores da Temporada", sub: "jujutsu_kaisen", qtd: 5 }
    ];

    async function carregarConteudo() {
        const mainContainer = document.getElementById('dynamic-sections');
        if(!mainContainer) return;
        mainContainer.innerHTML = "";

        for (const conf of configSessoes) {
            const section = document.createElement('section');
            section.className = 'content-section';
            section.innerHTML = `
                <h2 class="section-title">${conf.titulo}</h2>
                <div class="cards-row" id="row-${conf.sub}">
                    <p style="font-size:11px; opacity:0.5; color: #888;">Carregando...</p>
                </div>
            `;
            mainContainer.appendChild(section);

            try {
                // Mantendo o seu Path exatamente como ele é no banco
                const colRef = collection(db, "anigeeknews.web.app/animes_filmes_series_games_noticias/" + conf.sub);
                const q = query(colRef, limit(conf.qtd));
                const snap = await getDocs(q);
                
                const row = document.getElementById(`row-${conf.sub}`);
                if(!row) continue;
                row.innerHTML = "";

                snap.forEach(doc => {
                    const data = doc.data();
                    const cardTitulo = data.titulo || doc.id.replace(/_/g, ' ');
                    const cardCat = data.categoria || "Série";
                    const cardImg = data.capaNoticia || "https://via.placeholder.com/640x360?text=AniGeek+TV";
                    const linkDestino = data.linkArtigo || `index.html?id=${doc.id}`;

                    row.innerHTML += `
                        <div class="anime-card" onclick="location.href='${linkDestino}'">
                            <div class="poster-wrapper">
                                <img src="${cardImg}" class="poster-img" loading="lazy" alt="${cardTitulo}">
                            </div>
                            <div class="anime-title">${cardTitulo}</div>
                            <div class="anime-meta">${cardCat} • ${doc.id.substring(0,5)}</div>
                        </div>
                    `;
                });

                if(snap.empty) row.innerHTML = "<p style='font-size:11px; opacity:0.5'>Nenhum conteúdo disponível.</p>";

            } catch (e) { 
                console.error("Erro na busca:", e);
                const row = document.getElementById(`row-${conf.sub}`);
                if(row) row.innerHTML = "<p style='color:red; font-size:11px'>Erro ao carregar do Firebase.</p>";
            }
        }
    }

    carregarConteudo();
</script>

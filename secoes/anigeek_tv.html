<script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs, limit, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBC_ad4X9OwCHKvcG_pNQkKEl76Zw2tu6o",
    authDomain: "anigeeknews.firebaseapp.com",
    projectId: "anigeeknews",
    storageBucket: "anigeeknews.firebasestorage.app",
    messagingSenderId: "769322939926",
    appId: "1:769322939926:web:6eb91a96a3f74670882737"
  };

  const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();
  const db = getFirestore(app);

  const configSessoes = [
    { titulo: "Recomendações AnigeekTv", sub: "recomendacoes", qtd: 24 },
    { titulo: "Lançamentos", sub: "lancamentos", qtd: 24 },
    { titulo: "Novos Episódios", sub: "novos_episodios", qtd: 24 },
    { titulo: "Clássicos AnigeekTv", sub: "classicos_anigeektv", qtd: 24 },
    { titulo: "Melhores da Temporada", sub: "melhores_da_temporada", qtd: 24 }
  ];

  async function carregarConteudo() {
    const mainContainer = document.getElementById("dynamic-sections");
    if (!mainContainer) return;

    mainContainer.innerHTML = "";

    for (const conf of configSessoes) {
      try {
        // ✅ CAMINHO CORRETO DO FIRESTORE
        const colRef = collection(
          db,
          "animes_filmes_series_games_noticias",
          conf.sub
        );

        const q = query(colRef, limit(conf.qtd));
        const snap = await getDocs(q);

        // ❌ se não tem docs → não cria seção nenhuma
        if (snap.empty) continue;

        // ✅ cria seção SOMENTE se houver conteúdo
        const section = document.createElement("section");
        section.className = "content-section";

        const rowId = `row-${conf.sub}`;

        section.innerHTML = `
          <h2 class="section-title">${conf.titulo}</h2>
          <div class="cards-row" id="${rowId}"></div>
        `;

        mainContainer.appendChild(section);

        const row = document.getElementById(rowId);

        snap.forEach(doc => {
          const data = doc.data();

          const cardTitulo = data.titulo || doc.id.replace(/_/g, " ");
          const cardCat = data.categoria || "Série";

          const cardImg =
            data?.fichaCategoria?.perfilImg ||
            data.perfilImg ||
            data.capaNoticia ||
            data.capaUrl ||
            "https://via.placeholder.com/640x360?text=AniGeek+TV";

          const linkDestino = data.linkArtigo || `index.html?id=${doc.id}`;

          row.innerHTML += `
            <div class="anime-card" onclick="location.href='${linkDestino}'">
              <div class="poster-wrapper">
                <img src="${cardImg}" class="poster-img" loading="lazy" alt="${cardTitulo}">
              </div>
              <div class="anime-title">${cardTitulo}</div>
              <div class="anime-meta">${cardCat}</div>
            </div>
          `;
        });

      } catch (e) {
        console.error("Erro ao carregar sessão:", conf.sub, e);
      }
    }
  }

  carregarConteudo();
</script>

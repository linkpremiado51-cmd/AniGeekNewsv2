<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<div class="destaque-wrapper">
  <div id="notificacao-novo-artigo">
    <i class="fa-solid fa-satellite-dish"></i>
    <div>
      <div style="font-size: 7px; font-weight: 800; opacity: 0.8; text-transform: uppercase;">Atualização via Cloud</div>
      <div id="novo-artigo-titulo-local" style="font-size: 9.1px; font-weight: 700;">Conectando ao AniGeek...</div>
    </div>
  </div>

  <div id="hero-area-local"></div>
  <div id="feed-noticias-local"></div>
  
  <div id="pagination-control-local" style="text-align: center; padding: 21px; display: none;">
      <button id="btn-carregar-mais-local" class="btn-paginacao-geek">
          <i class="fa-solid fa-chevron-down"></i> Carregar mais conteúdos
      </button>
  </div>
</div>

<script type="module">
    // Importações necessárias para esta aba funcionar sozinha
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBC_ad4X9OwCHKvcG_pNQkKEl76Zw2tu6o",
      authDomain: "anigeeknews.firebaseapp.com",
      projectId: "anigeeknews",
      storageBucket: "anigeeknews.firebasestorage.app",
      messagingSenderId: "769322939926",
      appId: "1:769322939926:web:6eb91a96a3f74670882737"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let todasAsNoticias = [];
    let noticiasExibidas = 5;

    function renderizarNoticiasLocal() {
        const container = document.getElementById('feed-noticias-local');
        if (!container) return;
        container.innerHTML = ""; // Limpa antes de renderizar

        const listaParaExibir = todasAsNoticias.slice(0, noticiasExibidas);
        
        listaParaExibir.forEach(news => {
            const html = `
                <article class="destaque-secao" style="--tema-cor: ${news.cor}; margin-bottom: 20px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: var(--card-bg);">
                    <img src="${news.capaNoticia || news.capaUrl}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;">
                    <div style="padding: 15px;">
                        <div class="destaque-categoria" style="color: ${news.cor}">${news.categoria}</div>
                        <h2 style="font-size: 18px; margin: 10px 0;">${news.titulo}</h2>
                        <p style="font-size: 13px; opacity: 0.8;">${news.resumo}</p>
                    </div>
                </article>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });

        const btnPaginacao = document.getElementById('pagination-control-local');
        if(btnPaginacao) btnPaginacao.style.display = noticiasExibidas < todasAsNoticias.length ? 'block' : 'none';
    }

    // Escuta do Firebase específica para esta aba
    onSnapshot(collection(db, "analises"), (snapshot) => {
        todasAsNoticias = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        todasAsNoticias.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        const label = document.getElementById('novo-artigo-titulo-local');
        if(label && todasAsNoticias.length > 0) label.innerText = todasAsNoticias[0].titulo;
        
        renderizarNoticiasLocal();
    });

    document.getElementById('btn-carregar-mais-local').onclick = () => {
        noticiasExibidas += 5;
        renderizarNoticiasLocal();
    };
</script>
